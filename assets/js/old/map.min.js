var mymap,markeropa,catmarkers=[],savearray=[],teyvatarray=["statue","teleport","succes","pano","anemo","geocul","agate","sceaugeo","cordi","cdelic","cprec","cluxe","cdefi","cfee","sanctum","sanctul","betrang","bgivre","brocheux","bshaman","bviandu","fmens","chasseur","colosse","gardien","geosaure","magea","magel","frap","merc","mitrail","pilleur","usurier","ferblanc","argetoile","cristal","electrocris","eclatcm","artefact","dent","lapis","jade","noyauc","perle","conque","ffeu","fbrume","gdloup","pomme","carotte","radis","halampe","chrysantheme","lyscalla","tombaie","bacrochet","pissenlit","cecilia","chanemo","qingxin","muguet","piment","lysverni","fsoie","bambou","lotus","grenouille","lezard","papillon","luciole","crabe"],nbtmark=0,langue,lgmenu;function onMapClick(e){console.log(langue["ui-click"]+mymap.wrapLatLng(e.latlng))}function onMarkerClick(e){markeropa=this}function checkinfo(e){if(!localStorage.getItem("Mapvers")||"4.4"!==localStorage.Mapvers)if(localStorage.Mapvers="4.4","FR"===localStorage.MapLng)var infobox=lity("#infomajFR");else var infobox=lity("#infomajEN")}function getLscbx(name){return lscbx=localStorage.getItem("chkbox"+name),lscbx?lscbx=JSON.parse(lscbx):lscbx=[],lscbx}function initarray(){catmarkers.forEach((function(e){window[e+"array"]=getLscbx(e)}))}function selectarray(mtype,mnumb,mstate){array=window[mtype+"array"],mstate?(array.push(mnumb),markeropa.setOpacity(.45)):(array.splice(array.indexOf(""+mnumb),1),markeropa.setOpacity(1)),localStorage.setItem("chkbox"+mtype,JSON.stringify(array))}function activecb(mtype,mnumb){return cooktl=getLscbx(mtype),!!(cooktl&&cooktl.indexOf(""+mnumb)>=0)}function resetmarkers(){return doreset(),alert(langue["ui-reset"]),document.location.href="index.html"}function doreset(){catmarkers.forEach((function(e){localStorage.removeItem("chkbox"+e)}))}function savemarkers(){return savearray=["v2"],catmarkers.forEach((function(e){savearray.splice(savearray.length,0,e,getLscbx(e))})),savearray}function loadusermarkers(lstmrk){if("v2"==lstmrk[0]){doreset();for(var i=1,cbx;lstmrk[i];)cbx="chkbox"+lstmrk[i],localStorage.setItem(cbx,JSON.stringify(lstmrk[i+1])),i+=2;return alert(langue["ui-import"]),document.location.href="index.html"}alert(langue["ui-fileerror"])}function reselectmenu(){if($("#menu a[data-type]").each((function(){$(this).hasClass("active")&&mymap.addLayer(window[$(this).data("type")+"Group"])})),$(".matbtn").each((function(){$(this).hasClass("active")&&mymap.addLayer(window[$(this).data("type")+"Group"])})),localStorage.MenumapgenshinLi)var listatut=JSON.parse(localStorage.MenumapgenshinLi);else localStorage.MenumapgenshinLi=[];if(localStorage.MenumapgenshinBtn)var btnstatut=JSON.parse(localStorage.MenumapgenshinBtn);else localStorage.MenumapgenshinBtn=[];listatut&&listatut.forEach((function(element){$("#btn"+lgmenu+element).addClass("active"),mymap.addLayer(window[element+"Group"])})),btnstatut&&btnstatut.forEach((function(element){$("#btn"+lgmenu+element).addClass("active").attr("src","media/icones/"+element+"on.png"),mymap.addLayer(window[element+"Group"])}))}(mymap=L.map("mapid",{crs:L.CRS.Simple,minZoom:-3,maxZoom:2})).zoomControl.setPosition("topright"),mymap.setMaxBounds(new L.latLngBounds([-1e3,-1e3],[7344,7344]));var bounds=[[0,0],[6144,6144]],image=L.imageOverlay("media/map.jpg",bounds).addTo(mymap);mymap.fitBounds(bounds),teyvatarray.forEach((function(e){window[e+"Group"]=L.layerGroup()}));var BoutonMenu=L.easyButton({states:[{stateName:"close-menu",icon:'<img src="media/icones/menuoff.png">',title:langue["ui-close"],onClick:function(btn,mymap){$("body").toggleClass("show-menu"),mymap.invalidateSize(),btn.state("open-menu")}},{stateName:"open-menu",icon:'<img src="media/icones/menuon.png">',title:langue["ui-open"],onClick:function(btn,mymap){$("body").toggleClass("show-menu"),mymap.invalidateSize(),btn.state("close-menu")}}]});function loadmarker(marklist,markico,grp,marktitle,filename,cbxname){var marq=[],nfichier,i,mtype,checkbox="",popup="",curmarker,txt="",counternull=0,checkopa=getLscbx(cbxname),lgrp=window[grp+"Group"];for(void 0!==cbxname&&catmarkers.push(cbxname),i=0;i<marklist.length;i++){switch(mtype=(marq=marklist[i])[0],nfichier=filename+(i+1),void 0!==cbxname&&(checkbox='<br><h2><label><input id="mapbox" name="'+cbxname+'" value="'+(i+1)+'" type="checkbox" /> '+langue["ui-found"]+"</h2>"),mtype){case 0:popup='<a href="media/'+nfichier+'.jpg" data-lity><img class="thumb" src="media/'+nfichier+'.jpg"/></a>'+(txt=void 0!==marq[2]?"<br><h1>"+marq[2]+"</h1>":"")+checkbox;break;case 3:popup='<a href="media/'+nfichier+'.gif" data-lity><img class="thumb" src="media/'+nfichier+'.gif"/></a>'+(txt=void 0!==marq[2]?"<br><h1>"+marq[2]+"</h1>":"")+checkbox;break;case 5:txt=void 0!==marq[3]?"<br><h1>"+marq[3]+"</h1>":"",popup='<iframe width="560" height="315" src="//www.youtube.com/embed/'+marq[2]+'?rel=0" frameborder="0" allowfullscreen></iframe>'+txt+checkbox;break;case 11:popup="<h1>"+marq[2]+checkbox+"</h1>"}void 0!==cbxname?11==mtype?(curmarker=L.marker(marq[1],{icon:Null,title:""}).on("click",onMarkerClick).bindPopup(popup,popupOptions),counternull+=1):(5==mtype?titlem=void 0!==marq[4]?marq[4]:marktitle:0!=mtype&&3!=mtype||(titlem=void 0!==marq[3]?marq[3]:marktitle),curmarker=L.marker(marq[1],{icon:markico,title:titlem,riseOnHover:!0}).on("click",onMarkerClick).bindPopup(popup,popupOptions)):curmarker=12!==mtype?L.marker(marq[1],{icon:markico,title:marktitle,riseOnHover:!0}).bindPopup(popup,popupOptions):L.marker(marq[1],{icon:markico,title:marktitle}),checkopa.indexOf(""+(i+1))>=0&&curmarker.setOpacity(.45),curmarker.addTo(lgrp)}console.log(marktitle+" : "+(marklist.length-counternull)+langue["ui-load"]),nbtmark+=marklist.length-counternull}BoutonMenu.addTo(mymap),loadmarker(liststatue,Statue,"statue",langue.cat01,"statue"),loadmarker(listteleport,Teleport,"teleport",langue.cat02,"tp"),loadmarker(listsucces,Succes,"succes",langue.cat46,"succes","succes"),loadmarker(listsuccesl,Succes,"succes",langue.cat46,"","succesl"),loadmarker(listpano,Pano,"pano",langue.cat03,"pano","pano"),loadmarker(listpanol,Pano,"pano",langue.cat03,"panol","panol"),loadmarker(listanemo,Anemo,"anemo",langue.cat10,"anemo","anemo"),loadmarker(listgeocul,Geocul,"geocul",langue.cat29,"geoc","geocul"),loadmarker(listagate,Agate,"agate",langue.cat47,"agate","agate"),loadmarker(listsceaugeo,Sceaugeo,"sceaugeo",langue.cat30,"sg","sceaugeo"),loadmarker(listcordi,Cordi,"cordi",langue.cat04,"oc","cordi"),loadmarker(listcordil,Cordi,"cordi",langue.cat04,"ocl","cordil"),loadmarker(listcdelic,Cdelic,"cdelic",langue.cat05,"dc","cdelic"),loadmarker(listcdelicl,Cdelic,"cdelic",langue.cat05,"dcl","cdelicl"),loadmarker(listcprec,Cprec,"cprec",langue.cat06,"pc","cprec"),loadmarker(listcprecl,Cprec,"cprec",langue.cat06,"pcl","cprecl"),loadmarker(listcluxe,Cluxe,"cluxe",langue.cat07,"lc","cluxe"),loadmarker(listcluxel,Cluxe,"cluxe",langue.cat07,"lcl","cluxel"),loadmarker(listcdefi,Cdefi,"cdefi",langue.cat08,"defi","cdefi"),loadmarker(listcdefil,Cdefi,"cdefi",langue.cat08,"defil","cdefil"),loadmarker(listcfee,Cfee,"cfee",langue.cat09,"","cfee"),loadmarker(listcfeel,Cfee,"cfee",langue.cat09,"","cfeel"),loadmarker(listsanctum,Sanctum,"sanctum",langue.cat70,"sanctum","sanctum"),loadmarker(listsanctul,Sanctul,"sanctul",langue.cat71,"sanctul","sanctul"),loadmarker(listbetrang,Betrang,"betrang",langue.cat49,"betrang"),loadmarker(listbgivre,Bgivre,"bgivre",langue.cat67,"bgivre"),loadmarker(listbrocheux,Brocheux,"brocheux",langue.cat65,"brocheux"),loadmarker(listbshaman,Bshaman,"bshaman",langue.cat61),loadmarker(listbviandu,Bviandu,"bviandu",langue.cat51,"bviandu"),loadmarker(listfmcryo,Fmcryo,"fmens",langue.cat53,"fmcryo"),loadmarker(listfmpyro,Fmpyro,"fmens",langue.cat54,"fmpyro"),loadmarker(listchasseur,Chasseur,"chasseur",langue.cat66,"chasseur"),loadmarker(listcolosse,Colosse,"colosse",langue.cat75,"chasseur"),loadmarker(listgardien,Gardien,"gardien",langue.cat52,"gardien"),loadmarker(listgeosaure,Geosaure,"geosaure",langue.cat55,"geosaure"),loadmarker(listmagecryo,Magecryo,"magea",langue.cat56,"magec"),loadmarker(listmagehydro,Magehydro,"magea",langue.cat57,"mageh"),loadmarker(listmagepyro,Magepyro,"magea",langue.cat58,"magep"),loadmarker(listmagecl,Magecl,"magel",langue.cat59,"magecl"),loadmarker(listmageel,Mageel,"magel",langue.cat60,"mageel"),loadmarker(listfrapa,Frapa,"frap",langue.cat68,"frapa"),loadmarker(listfrape,Frape,"frap",langue.cat69,"frape"),loadmarker(listmercg,Mercg,"merc",langue.cat72,"mercg"),loadmarker(listmercp,Mercp,"merc",langue.cat73,"mercp"),loadmarker(listmitrailc,Mitrailc,"mitrail",langue.cat62,"mitc"),loadmarker(listmitrailh,Mitrailh,"mitrail",langue.cat63,"mith"),loadmarker(listpilleur,Pilleur,"pilleur",langue.cat77,"pilleur"),loadmarker(listusurier,Usurier,"usurier",langue.cat50,"usurier"),loadmarker(listferblanc,Ferblanc,"ferblanc",langue.cat25),loadmarker(listargetoile,Argetoile,"argetoile",langue.cat48),loadmarker(listcristal,Cristal,"cristal",langue.cat11),loadmarker(listelectroc,Electrocris,"electrocris",langue.cat12),loadmarker(listeclatcm,Eclatcm,"eclatcm",langue.cat26),loadmarker(listdent,Dent,"dent",langue.cat78,"dent"),loadmarker(listartefact,Artefact,"artefact",langue.cat76),loadmarker(listlapis,Lapis,"lapis",langue.cat41),loadmarker(listjade,Jade,"jade",langue.cat39),loadmarker(listnoyauc,Noyauc,"noyauc",langue.cat44),loadmarker(listperle,Perle,"perle",langue.cat32),loadmarker(listconque,Conque,"conque",langue.cat40),loadmarker(listffeu,Ffeu,"ffeu",langue.cat14),loadmarker(listfbrume,Fbrume,"fbrume",langue.cat13),loadmarker(listgdloup,Gdloup,"gdloup",langue.cat45),loadmarker(listpomme,Pomme,"pomme",langue.cat15),loadmarker(listcarotte,Carotte,"carotte",langue.cat16),loadmarker(listradis,Radis,"radis",langue.cat17),loadmarker(listhalampe,Halampe,"halampe",langue.cat20),loadmarker(listchrysantheme,Chrysantheme,"chrysantheme",langue.cat21),loadmarker(listlyscalla,Lyscalla,"lyscalla",langue.cat22),loadmarker(listtombaie,Tombaie,"tombaie",langue.cat18),loadmarker(listbacrochet,Bacrochet,"bacrochet",langue.cat24),loadmarker(listpissenlit,Pissenlit,"pissenlit",langue.cat19),loadmarker(listchanemo,Chanemo,"chanemo",langue.cat74),loadmarker(listcecilia,Cecilia,"cecilia",langue.cat23),loadmarker(listqingxin,Qingxin,"qingxin",langue.cat34),loadmarker(listmuguet,Muguet,"muguet",langue.cat35,"muguet"),loadmarker(listpiment,Piment,"piment",langue.cat36),loadmarker(listlysverni,Lysverni,"lysverni",langue.cat37),loadmarker(listfsoie,Fsoie,"fsoie",langue.cat38),loadmarker(listbambou,Bambou,"bambou",langue.cat31),loadmarker(listlotus,Lotus,"lotus",langue.cat33),loadmarker(listgrenouille,Grenouille,"grenouille",langue.cat27),loadmarker(listlezard,Lezard,"lezard",langue.cat28),loadmarker(listpapillon,Papillon,"papillon",langue.cat42),loadmarker(listluciole,Luciole,"luciole",langue.cat43),loadmarker(listcrabe,Crabe,"crabe",langue.cat64),$("#total"+lgmenu).text(nbtmark+langue["ui-load"]),mymap.on("click",onMapClick),mymap.on("popupopen",(function(){if($(":checkbox").on("change",(function(){var checkboxtype,checkboxnumber,checkboxstate;selectarray(this.name,this.value,this.checked)})),document.getElementById("mapbox")){var checkboxtype,checkboxnumber,checkboxstate=activecb(document.getElementById("mapbox").name,document.getElementById("mapbox").value);$("#mapbox").prop("checked",checkboxstate)}})),$("#menu a[data-type]").on("click",(function(e){e.preventDefault();var type=$(this).data("type");$(this).toggleClass("active"),$(this).hasClass("active")?mymap.addLayer(window[type+"Group"]):mymap.removeLayer(window[type+"Group"]);var listatut=[];$("#menu a[data-type]").each((function(){$(this).hasClass("active")&&listatut.indexOf($(this).data("type"))<0&&listatut.push($(this).data("type"))})),localStorage.MenumapgenshinLi=JSON.stringify(listatut)})),$(".matbtn").on("click",(function(){var ndf=$(this).data("type");$(this).hasClass("active")?($(this).attr("src","media/icones/"+ndf+"off.png"),$(this).toggleClass("active"),mymap.removeLayer(window[ndf+"Group"])):($(this).attr("src","media/icones/"+ndf+"on.png"),$(this).toggleClass("active"),mymap.addLayer(window[ndf+"Group"]));var btnstatut=[];$(".matbtn").each((function(){$(this).hasClass("active")&&btnstatut.indexOf($(this).data("type"))<0&&btnstatut.push($(this).data("type"))})),localStorage.MenumapgenshinBtn=JSON.stringify(btnstatut)})),$(".btninfo").on("click",(function(){if("FR"===localStorage.MapLng)var infobox=lity("#infoFR");else var infobox=lity("#infoEN")})),$(".btnreset").on("click",(function(){confirm(langue["ui-prereset"])&&resetmarkers()})),$(".btnlg").on("click",(function(){"FR"===localStorage.MapLng?localStorage.MapLng="EN":localStorage.MapLng="FR",document.location.href="index.html"})),$(".btnsave").on("click",(function(){this.href=URL.createObjectURL(new Blob([JSON.stringify(savemarkers())])),alert(langue["ui-export"])})),$(".btnload").on("click",(function(e){var fileElem=document.getElementById("ImportBox");fileElem&&fileElem.click(),e.preventDefault()})),$("#ImportBox").on("change",(function(ev_){var fr_;(fr_=new FileReader).onload=function(ev_){loadusermarkers(JSON.parse(this.result))},fr_.readAsText(this.files[0])})),$(".btngolden").on("click",(function(){document.location.href="index2.html"})),initarray(),reselectmenu(),checkinfo();