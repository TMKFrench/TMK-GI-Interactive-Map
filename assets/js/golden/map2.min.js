var mymap,markeropa,catmarkers=[],savearray=[],teyvatarray=["echo1","echo2","echo3","echo4","echo5","echo6","echo7","evt","teleport","tpbarge","succes","cordi","cdelic","cprec","cluxe","cdefi","cfee","cpeint","charp","bshaman","bviandu","magea","ferblanc","cristal","electrocris","noyauc","conque","ffeu","fbrume","carotte","radis","pissenlit","grenouille","lezard","papillon","luciole","crabe"],nbtmark=0,langue,lgmenu;function onMapClick(e){console.log(langue["ui-click"]+mymap.wrapLatLng(e.latlng))}function onMarkerClick(e){markeropa=this}function checkinfo(e){if(!localStorage.getItem("Mapversg")||"1.6.4"!==localStorage.Mapversg)if(localStorage.Mapversg="1.6.4","FR"===localStorage.MapLng)var infobox=lity("#infomajFR");else var infobox=lity("#infomajEN")}function getLscbx(name){return lscbx=localStorage.getItem("chkbox"+name),lscbx?lscbx=JSON.parse(lscbx):lscbx=[],lscbx}function initarray(){catmarkers.forEach((function(e){window[e+"array"]=getLscbx(e)}))}function selectarray(mtype,mnumb,mstate){array=window[mtype+"array"],mstate?(array.push(mnumb),markeropa.setOpacity(.45)):(array.splice(array.indexOf(""+mnumb),1),markeropa.setOpacity(1)),localStorage.setItem("chkbox"+mtype,JSON.stringify(array))}function activecb(mtype,mnumb){return cooktl=getLscbx(mtype),!!(cooktl&&cooktl.indexOf(""+mnumb)>=0)}function resetmarkers(){return doreset(),alert(langue["ui-reset"]),document.location.href="index2.html"}function doreset(){catmarkers.forEach((function(e){localStorage.removeItem("chkbox"+e)}))}function savemarkers(){return savearray=["v2"],catmarkers.forEach((function(e){savearray.splice(savearray.length,0,e,getLscbx(e))})),savearray}function loadusermarkers(lstmrk){if("v2"==lstmrk[0]){doreset();for(var i=1,cbx;lstmrk[i];)cbx="chkbox"+lstmrk[i],localStorage.setItem(cbx,JSON.stringify(lstmrk[i+1])),i+=2;return alert(langue["ui-import"]),document.location.href="index2.html"}alert(langue["ui-fileerror"])}function reselectmenu(){if($("#menu a[data-type]").each((function(){$(this).hasClass("active")&&mymap.addLayer(window[$(this).data("type")+"Group"])})),$(".matbtn").each((function(){$(this).hasClass("active")&&mymap.addLayer(window[$(this).data("type")+"Group"])})),localStorage.MenumapgenshinLiG)var listatut=JSON.parse(localStorage.MenumapgenshinLiG);else localStorage.MenumapgenshinLiG=[];if(localStorage.MenumapgenshinBtnG)var btnstatut=JSON.parse(localStorage.MenumapgenshinBtnG);else localStorage.MenumapgenshinBtnG=[];listatut&&listatut.forEach((function(element){$("#btn"+lgmenu+element).addClass("active"),mymap.addLayer(window[element+"Group"])})),btnstatut&&btnstatut.forEach((function(element){$("#btn"+lgmenu+element).addClass("active").attr("src","media/icones/"+element+"on.png"),mymap.addLayer(window[element+"Group"])}))}(mymap=L.map("mapid",{crs:L.CRS.Simple,minZoom:-3,maxZoom:1})).zoomControl.setPosition("topright"),mymap.setMaxBounds(new L.latLngBounds([-1e3,-1e3],[9192,9192]));var bounds=[[0,0],[8192,8192]],image=L.imageOverlay("media/mapgolden.jpg",bounds).addTo(mymap);mymap.fitBounds(bounds),teyvatarray.forEach((function(e){window[e+"Group"]=L.layerGroup()}));var BoutonMenu=L.easyButton({states:[{stateName:"close-menu",icon:'<img src="media/icones/menuoff.png">',title:langue["ui-close"],onClick:function(btn,mymap){$("body").toggleClass("show-menu"),mymap.invalidateSize(),btn.state("open-menu")}},{stateName:"open-menu",icon:'<img src="media/icones/menuon.png">',title:langue["ui-open"],onClick:function(btn,mymap){$("body").toggleClass("show-menu"),mymap.invalidateSize(),btn.state("close-menu")}}]});function loadmarker(marklist,markico,grp,marktitle,filename,cbxname){var marq=[],nfichier,i,mtype,checkbox="",popup="",curmarker,txt="",counternull=0,checkopa=getLscbx(cbxname),lgrp=window[grp+"Group"];for(void 0!==cbxname&&catmarkers.push(cbxname),i=0;i<marklist.length;i++){switch(mtype=(marq=marklist[i])[0],nfichier=filename+(i+1),void 0!==cbxname&&(checkbox='<br><h2><label><input id="mapbox" name="'+cbxname+'" value="'+(i+1)+'" type="checkbox" /> '+langue["ui-found"]+"</h2>"),mtype){case 0:popup='<a href="media/'+nfichier+'.jpg" data-lity><img class="thumb" src="media/'+nfichier+'.jpg"/></a>'+(txt=void 0!==marq[2]?"<br><h1>"+marq[2]+"</h1>":"")+checkbox;break;case 3:popup='<a href="media/'+nfichier+'.gif" data-lity><img class="thumb" src="media/'+nfichier+'.gif"/></a>'+(txt=void 0!==marq[2]?"<br><h1>"+marq[2]+"</h1>":"")+checkbox;break;case 5:txt=void 0!==marq[3]?"<br><h1>"+marq[3]+"</h1>":"",popup='<iframe width="560" height="315" src="//www.youtube.com/embed/'+marq[2]+'?rel=0" frameborder="0" allowfullscreen></iframe>'+txt+checkbox;break;case 11:popup="<h1>"+marq[2]+checkbox+"</h1>"}void 0!==cbxname?11==mtype?(curmarker=L.marker(marq[1],{icon:Null,title:""}).on("click",onMarkerClick).bindPopup(popup,popupOptions),counternull+=1):(5==mtype?titlem=void 0!==marq[4]?marq[4]:marktitle:0!=mtype&&3!=mtype||(titlem=void 0!==marq[3]?marq[3]:marktitle),curmarker=L.marker(marq[1],{icon:markico,title:titlem,riseOnHover:!0}).on("click",onMarkerClick).bindPopup(popup,popupOptions)):curmarker=12!==mtype?L.marker(marq[1],{icon:markico,title:marktitle,riseOnHover:!0}).bindPopup(popup,popupOptions):L.marker(marq[1],{icon:markico,title:marktitle}),checkopa.indexOf(""+(i+1))>=0&&curmarker.setOpacity(.45),curmarker.addTo(lgrp)}console.log(marktitle+" : "+(marklist.length-counternull)+langue["ui-load"]),nbtmark+=marklist.length-counternull}BoutonMenu.addTo(mymap),loadmarker(listteleport,Teleport,"teleport",langue.cat02,"tpg"),loadmarker(listtpbarge,Tpbarge,"tpbarge",langue.cat03,"tpb"),loadmarker(listtpbargeold,Tpbarge,"tpbarge",langue.cat81,"tpbo"),loadmarker(listcordi,Cordi,"cordi",langue.cat04,"ocg","cordig"),loadmarker(listcdelic,Cdelic,"cdelic",langue.cat05,"dcg","cdelicg"),loadmarker(listcprec,Cprec,"cprec",langue.cat06,"pcg","cprecg"),loadmarker(listcluxe,Cluxe,"cluxe",langue.cat07,"lcg","cluxeg"),loadmarker(listcdefi,Cdefi,"cdefi",langue.cat08,"defig","cdefig"),loadmarker(listcfee,Cfee,"cfee",langue.cat09,"","cfeeg"),loadmarker(listcpeint,Cpeint,"cpeint",langue.cat82,"cpeint","cpeint"),loadmarker(listcharp,Charp,"charp",langue.cat83,"charp","charp"),loadmarker(listferblanc,Ferblanc,"ferblanc",langue.cat25),loadmarker(listcristal,Cristal,"cristal",langue.cat11),loadmarker(listelectroc,Electrocris,"electrocris",langue.cat12),loadmarker(listconque,Conque,"conque",langue.cat40),loadmarker(listcarotte,Carotte,"carotte",langue.cat16),loadmarker(listradis,Radis,"radis",langue.cat17),loadmarker(listffeu,Ffeu,"ffeu",langue.cat14),loadmarker(listfbrume,Fbrume,"fbrume",langue.cat13),loadmarker(listpissenlit,Pissenlit,"pissenlit",langue.cat19),loadmarker(listcrabe,Crabe,"crabe",langue.cat64),loadmarker(listecho1,Echo1,"echo1",langue.cat79,"echo1","echo1"),loadmarker(listecho2,Echo2,"echo2",langue.cat79,"echo2","echo2"),loadmarker(listecho3,Echo3,"echo3",langue.cat79,"echo3","echo3"),loadmarker(listecho4,Echo4,"echo4",langue.cat79,"echo4","echo4"),loadmarker(listecho5,Echo5,"echo5",langue.cat79,"echo5","echo5"),loadmarker(listecho6,Echo6,"echo6",langue.cat79,"echo6","echo6"),loadmarker(listecho7,Echo7,"echo7",langue.cat79,"echo7","echo7"),loadmarker(listevt,Evt,"evt",langue.cat84),$("#total"+lgmenu).text(nbtmark+langue["ui-load"]),mymap.on("click",onMapClick),mymap.on("popupopen",(function(){if($(":checkbox").on("change",(function(){var checkboxtype,checkboxnumber,checkboxstate;selectarray(this.name,this.value,this.checked)})),document.getElementById("mapbox")){var checkboxtype,checkboxnumber,checkboxstate=activecb(document.getElementById("mapbox").name,document.getElementById("mapbox").value);$("#mapbox").prop("checked",checkboxstate)}})),$("#menu a[data-type]").on("click",(function(e){e.preventDefault();var type=$(this).data("type");$(this).toggleClass("active"),$(this).hasClass("active")?mymap.addLayer(window[type+"Group"]):mymap.removeLayer(window[type+"Group"]);var listatut=[];$("#menu a[data-type]").each((function(){$(this).hasClass("active")&&listatut.indexOf($(this).data("type"))<0&&listatut.push($(this).data("type"))})),localStorage.MenumapgenshinLiG=JSON.stringify(listatut)})),$(".matbtn").on("click",(function(){var ndf=$(this).data("type");$(this).hasClass("active")?($(this).attr("src","media/icones/"+ndf+"off.png"),$(this).toggleClass("active"),mymap.removeLayer(window[ndf+"Group"])):($(this).attr("src","media/icones/"+ndf+"on.png"),$(this).toggleClass("active"),mymap.addLayer(window[ndf+"Group"]));var btnstatut=[];$(".matbtn").each((function(){$(this).hasClass("active")&&btnstatut.indexOf($(this).data("type"))<0&&btnstatut.push($(this).data("type"))})),localStorage.MenumapgenshinBtnG=JSON.stringify(btnstatut)})),$(".btninfo").on("click",(function(){if("FR"===localStorage.MapLng)var infobox=lity("#infoFR");else var infobox=lity("#infoEN")})),$(".btnreset").on("click",(function(){confirm(langue["ui-prereset"])&&resetmarkers()})),$(".btnlg").on("click",(function(){"FR"===localStorage.MapLng?localStorage.MapLng="EN":localStorage.MapLng="FR",document.location.href="index2.html"})),$(".btnsave").on("click",(function(){this.href=URL.createObjectURL(new Blob([JSON.stringify(savemarkers())])),alert(langue["ui-export"])})),$(".btnload").on("click",(function(e){var fileElem=document.getElementById("ImportBox");fileElem&&fileElem.click(),e.preventDefault()})),$("#ImportBox").on("change",(function(ev_){var fr_;(fr_=new FileReader).onload=function(ev_){loadusermarkers(JSON.parse(this.result))},fr_.readAsText(this.files[0])})),$(".btnteyvat").on("click",(function(){document.location.href="index.html"})),initarray(),reselectmenu(),checkinfo();